---
title: 配置URL适配规则
header: introduction
nav: book
sidebar: rank_url
---

**1.为什么要配置URL适配规则？**
设置URL适配规则，可以使百度搜索得到您的小程序页面与H5页面之间的对应关系。精确的URL适配规则有助于百度搜索更快收录小程序资源并继承原有H5的搜索流量。因此配置 URL适配规则对小程序进入搜索至关重要。
**2.URL适配规则该怎么填写？**
通过正则表达式的方式声明 H5 链接与小程序路径间的对应关系。格式举例：

>H5：`http://example.com/detail?id=1`
小程序路径：`/pages/detail/index?id=1`
这组对应关系可以用以下规则描述：
`http://example.com/detail?id=([^&]+)=> pages/detail/index?id=${1}`

如上例所示，“=>” 左侧部分为 H5 链接生成的正则表达式，标识了 H5 地址中与小程序参数有对应关系的部分；“=>”右侧部分由小程序路径和参数对组成。参数对中如果某个参数值是左侧匹配到的部分，则其参数值由${左侧匹配项的序号}代替。

**2.1更多示例**

| H5 地址 | 小程序路径 |
|-|-|
| https://example.com/ | pages/home/index |
```
// 如果要完全匹配到 url 结尾，例如当 url 后没有 path 时，适配小程序首页 path，url 后要加结束符
https://example.com/$ => pages/home/index
```

|H5 地址|小程序路径|
|--|--|
| `https://example.com/book?id=1&type=history`| pages/book/index?bookid=1&type=history |
```
https://example.com/book?id=([^&]+)&type=([^&]+) => pages/book/index?bookid=${1}&type=${2}

// 只要是符合正则规则的匹配方式都可以，例如下述规则也同样正确
https://example.com/book?id=([\w]+)&type=(.+)$ => pages/book/index?bookid=${1}&type=${2}
```

|H5 地址 |小程序路径 |
|-|-|
| `https://example.com/history/book?id=1` | pages/book/index?bookid=1&type=history |
```
// 参数部分序号根据正则匹配的顺序决定
https://example.com/([^\/]+)/book?id=([^&]+) => pages/book/index?bookid=${2}&type=${1}
```

| H5 地址 | 小程序路径 |
|-|-|
| `https://example.com/history_type/book?id=1 `| pages/book/index?bookid=1&type=history |
```
https://example.com/([^\_]+)_type/book?id=([^&]+) => pages/book/index?bookid=${2}&type=${1}
```

| H5 地址 | 小程序路径 |
|-|-|
| `https://example.com/book/1.html` | pages/book/index?bookid=1&type=history |
```
// 两个地址中没有对应项的参数保持不变
https://example.com/book/([^\.]+).html => pages/book/index?bookid=${1}&type=history
```

| H5 地址 | 小程序路径 |
|-|-|
| `https://example.com/book/history2019.html?id=1 `| pages/book?type=history |
```
https://example.com/book/([^\d]+)2019.html?id=1 => pages/book?type=${1}
```
3. 小程序接入搜索Sitemap反馈失败及URL替换失败错误原因详解
开发者在小程序接入搜索的过程中，如遇到Sitemap反馈失败及URL替换失败的错误反馈，可以根据页面反馈及参照本文引导进行自查，通过本文列举的7种错误原因及处理方式，能够帮助开发者更快速准确的完成修改。

 - **资源未收录：**您的规则对应的H5或小程序资源未被收录，您可将对应小程序资源通过sitemap方式提交。 
 - **小程序页面死链：**您的规则对应小程序资源存在内容死链或死链率较高，请自查修复后重新提交。
 - **小程序页面存在第三方跳转：**您的规则对应小程序资源存在跳转H5、嵌套H5等情况，请自查修复后重新提交，我们不建议提交webview模式小程序，建议开发原生小程序。
 - **H5页面死链：**您的规则对应H5资源页面死链，请自查修复后重新提交。
 - **主体内容不一致：**您的规则对应的小程序页面与H5页面内容不一致，请自查页面基础信息如title、正文主体、页面版块是否基本一致，修改一致后重新提交规则。
 - **规则异常：**您所提交的适配规则存在异常，请自查正则表达式拼写是否正确，是否存在空格、乱码、异常符号等情况，纠错后重新提交。
 - **规则被占用：**您所提交的适配规则已被另一规则占用并优先生效，请自查规则之间是否存在重复，修复后重新提交。
 - **小程序path不规范：**您提交的小程序path不符合约定格式，在提交规则时需要注意符合以下规范：
    1）小程序path不能带有#标记
    “#”这个符号在通用url中标记锚文本，和不带#的url表示同一个页面。请不要在小程序path中夹带#标记，避免适配出错。
    2）小程序path参数不能为路径
    小程序path可以带参数，但需注意，参数不可以是一条路径，也不可以是一条H5 url。以下这三类都是不符合规范的：
    xxx.smartapp.cn/parameter_a=/path1/file，
    xxx.smartapp.cn/parameter=http://xxx.baidu.com/path1/1.html，
    xxx.smartapp.cn/parameter=xxx.baidu.com/path1/1.html。
    如需带相关参数，务必清晰表述参数名和参数定义，如dir_name=news。
 - **页面内容低质：您所提交的适配规则对应小程序页面内容低质，请自查是否存在以下几方面错误，修复后重新提交。
    1）页面是否空白、空短：①页面无内容示例请见下图一 ②页面空短示例请见下图二；
    2）页面访问是否稳定，页面是否加载、响应时间过长，导致页面无法获取完整内容。页面访问不稳定一直加载中请见下图三；
    ![图片](../../img/introduction/rank/rank729.png)

    3）已下架、已过期类资源不建议提交：
    如电商类、招聘类等开发者经常会有大量的产品下架、售空、资源过期等情况，此类资源不建议再提交sitemap。
    4）切勿资源采集、拼凑：
    如果小程序资源存在大量从其他站点或公众号等内容生产方采集、搬运而来的内容，信息未经整合，排版混乱，文章可读性差，有明显采集痕迹，则对用户无任何增益价值，被视为低质内容。

以上就是提交反馈的10种问题反馈的详解，对已反馈数据失败的情况，sitemap及url替换，均需要各位修复数据后，再次提交sitemap或规则。


**4.智能小程序平台配置 URL 适配关系**
在【开发者平台】>【自然搜索结果中】>【URL适配规则】，当开发者需要对已有 H5资源配置时，可在 URL 适配规则的配置模块完成相应内容的设置，具体步骤如下：
 ![Alt text](../../img/introduction/rank/8.png)
**第一步：**点击页面中的“新建”按钮后，选择“设置 URL适配规则”进行配置。如对规则不够熟悉，也可以使用第二条“URL适配规则生成工具”来辅助配置。
 ![Alt text](../../img/introduction/rank/9.png)
**第二步：**在 URL 适配规则的设置页面中，开发者需要填写具体H5 链接表达式和对应的小程序 path（路径） 表达式，并至少提供一对示例链接，用于验证规则准确性。
开发者可在本页面添加多组规则。
 ![Alt text](../../img/introduction/rank/10.png)
**第三步：**当完成验证并提交后，系统将自动对该规则覆盖的 H5资源进行替换处理（优先对 TOP 流量的 H5资源进行替换）。因此，开发者需要保证对应的小程序页面已完成“页面基础信息”的设置。
 ![Alt text](../../img/introduction/rank/11.png)
**第四步：**查看规则生效情况。点击TOP URL替换明细，可以查看替换的结果
 ![Alt text](../../img/introduction/rank/12.png)
 ![Alt text](../../img/introduction/rank/13.png)

**5. URL 适配规则 – 生成工具**
URL 适配规则的辅助生成工具，也可以通过规则编辑页面进入。在规则辅助生成工具的页面中，开发者只需要按照工具的引导，提供 H5 URL 示例和小程序 Path 示例，并根据提示进行校验后，即可生成对应的 URL 适配规则表达式。
 ![Alt text](../../img/introduction/rank/14.png)
 ![Alt text](../../img/introduction/rank/15.png)
为方便开发者操作，点击下方的“一键保存至平台”后，规则会直接复制到配置工具中，用户可以按照提示完成新建和提交。也可以选择自主撰写规则后提交。

**6. URL适配规则提交后未替换成功的常见问题原因**

URL适配规则提交在4.25日升级，升级后，开发者仅需要提交需替换资源的小程序Web化规则即可；之前推送过的URL适配规则不需要改动。所以URL适配规则提交后未替换成功的常见原因，则可以分为策略上线前后来看：

 - 策略上线之前，URL适配规则提交后未替换成功的主要原因有以下9点：
 
    1. 对应H5站点未收录，URL适配规则主要是替换原有H5展示，如果H5页面未收录，则无法进行替换成功。
    2. 小程序页面与H5页面相似度不够。页面相似度要求两个页面的主体内容尽可能一致，这里除了包括页面中标题，内容的一致性外，最重要的是页面板块也需要有对应，部分开发者在H5站页面板块较多，一页内容中包括正文、推荐、评论等板块，但是小程序页面只做了正文部分，那这种情况下相似度是无法达到一致的。
    3. Web化地址中含有大量不常见参数，如：/、%等，会导致无法识别适配，建议开发者规范web化。
    4. Web化URL中的参数不能是一个路径：比如?arg=/xxx/xxx/xx。
    5. 小程序web化url中的参数内容在pc/h5的url中没有，无法形成规则适配关系。
    6. Web化大小写问题，如：https://2222.smartapps.cn/pages/article/RRRR 和 https://2222.smartapps.cn/pages/article/rrrr 两个Web化地址同时存在且内容不一致，建议开发者不要出现此类情况，这类情况也会出现替换出错问题。
    7. Web化访问问题，如Web化访问不稳定，页面不存在，则会出现抓取识别，无法替换的情况。
    8. 使用Webview方式改造小程序，Webview主要表现为小程序内嵌套H5，点击小程序页面则会跳出到H5页面，此类页面用户体验十分不友好，此类情况URL适配规则和Sitemap都将是拒绝处理，也请开发者了解。
    9. Web化页面问题，如Web化页面打开空白、内容空短，需授权登录才可以访问等，此类页面会被搜索识别为不优质页面，无法进行资源替换。

 - 4.25日升级URL适配规则提交，除以上需要关注的原因，提交未替换原因还有以下两点：

    1. 小程序后台有TOP URL提示引导，请开发者尽量提交TOP URL进行替换，TOP URL指，在搜索中获得较高点击的H5 URL；TOP URL将会优先下发并生效，非TOP类资源则生效周期较慢，此问题我们也在积极解决，尽量提升全部资源的替换效率
    2. Web化地址改变；目前发现的部分开发者出现小程序回退H5或替换未生效，追查后发现均为开发者Web化更改路径，或Web化打不开，导致无法替换或替换失效。

**7. 小程序数据提示“替换中”的解决方案**    

开发者在提交小程序数据后，会出现已替换、替换失败（可查看具体原因反馈）、及替换中的状态。目前数据替换需一周时间完成，即自数据提交一周后，如数据仍提示替换中，则可通过“先自查、后反馈”的方式定位解决问题，自查方式及反馈途径如下：
**7.1 开发者需自查部分：web化与H5是否收录**
**可能原因 1：Web化未收录**。需开发者自查，是否存在页面白屏、页面乱码、资源死链、页面内容为空、页面加载过慢甚至打不开等情况，如有以上情况，则数据无法进行正常校验替换。
**解决方案：**建议资源整改完毕后重新提交。

**可能原因 2：H5未收录（此原因较常见）**。开发者可通过“关键词+site:H5域名”或H5 url线上搜索的方式查找H5资源是否收录；若H5为新增资源，也可能会出现资源未收录的情况。
**解决方案：**如H5资源未收录，则建议直接将小程序web化资源提交Sitemap。
**7.2 反馈路径**
若数据提交超过一周仍显示“替换中”，且自查原因后仍无法定位问题，请在小程序[社区](https://smartprogram.baidu.com/forum/ )进行反馈。
**7.3 注意事项**

开发者提交资源后，可通过后台数据反馈查看替换明细，路径如下：智能小程序开发者平台——流量配置——自然搜索结果——URL适配规则。
如下图，点击该版块右侧的“TOP流量URL替换明细”，可查看替换进度。
 ![Alt text](../../img/introduction/rank/16.png)
 ![Alt text](../../img/introduction/rank/17.png)
其中，“替换失败URL” tab下显示具体的失败原因。
* 若替换反馈的失败原因为页面白屏、页面404、缺少SEO信息等，请修改后重新提交规则。修改文档请参考上方的配置URL适配规则。
* 若替换反馈的失败原因为主体内容不一致，表示小程序页面与对应H5页面相似度不够。页面相似度要求两个页面的主体内容尽可能一致，除了页面中标题、内容的一致性外，最重要的是页面版块也需对应，若H5页面含有正文、推荐、评论等多个版块，而小程序页面只有正文部分，则相似度校验无法通过，需修改后重新提交。
